name: RDP + Auto Run Main.py

on: 
  workflow_dispatch

jobs:
  rdp-and-run:
    runs-on: windows-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Requirements (kalau ada)
        run: |
          if (Test-Path "requirements.txt") {
            pip install -r requirements.txt
          }

      - name: Enable RDP
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

      - name: Set RDP Credentials
        run: |
          $user = "V"
          $password = "Root123"
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          
          if (-not (Get-LocalUser -Name $user -ErrorAction SilentlyContinue)) {
              New-LocalUser -Name $user -Password $securePassword
          } else {
              Set-LocalUser -Name $user -Password $securePassword
          }
          Add-LocalGroupMember -Group "Administrators" -Member $user

      - name: Jalankan Main.py via PowerShell
        run: |
          Write-Host "üöÄ Menjalankan main.py..."
          python main.py
          Write-Host "‚úÖ Main.py selesai!"

      - name: Keep Alive (biar RDP tetap nyala)
        run: |
          Write-Host "üñ•Ô∏è RDP Aktif! User: V | Pass: Root123"
          while ($true) { Start-Sleep -Seconds 60 }
